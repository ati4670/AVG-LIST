// ==UserScript==
// @name         Nyaa 超連結變紅（GitHub 版）
// @namespace    https://sukebei.nyaa.si/
// @version      1.7
// @description  從 GitHub 讀取關鍵字，讓符合條件的超連結變紅
// @author       你的名字
// @match        https://sukebei.nyaa.si/*
// @grant        GM_xmlhttpRequest
// @connect      raw.githubusercontent.com
// @run-at       document-end
// ==/UserScript==

(function () {
    'use strict';

    const keywordsURL = "https://raw.githubusercontent.com/ati4670/AVG-LIST/refs/heads/main/AVG-List.txt"; // GitHub 連結
    let keywords = [];

    function fetchKeywords() {
        GM_xmlhttpRequest({
            method: "GET",
            url: keywordsURL,
            onload: function(response) {
                if (response.status === 200) {
                    keywords = response.responseText.split(/\r?\n/).map(word => word.trim()).filter(word => word !== "");
                    console.log("載入關鍵字：", keywords);
                    highlightLinks();
                } else {
                    console.error("無法載入關鍵字文件");
                }
            },
            onerror: function() {
                console.error("關鍵字文件載入錯誤");
            }
        });
    }

    function highlightLinks() {
        document.querySelectorAll('a').forEach(link => {
            let text = link.innerText || link.textContent;
            keywords.forEach(keyword => {
                if (text.includes(keyword)) {
                    link.style.color = "red";  // 讓整個超連結變紅色
                    link.style.fontWeight = "bold";  // 讓超連結加粗
                }
            });
        });
    }

    // 監聽 DOM 變動，確保 AJAX 載入的超連結也會變紅
    const observer = new MutationObserver(() => highlightLinks());
    observer.observe(document.body, { childList: true, subtree: true });

    // 先抓取關鍵字再執行
    fetchKeywords();
})();
